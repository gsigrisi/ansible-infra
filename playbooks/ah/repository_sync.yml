---
- name: sync pah repositories
  hosts: localhost
  connection: local
  gather_facts: no
  collections:
    - infra.ah_configuration

  vars_files:
    - "{{ playbook_dir }}/../../vaults/{{ env }}-vault.yml"

  vars:
    ah_configuration_collection_repository_sync_async_retries: 1200
    ah_collection_repositories:
      - name: rh-certified
        wait: true
        timeout: 1200
      - name: community
        wait: true
        timeout: 1200
    
  pre_tasks:
    - name: create a new token using controller username/password
      ansible.controller.token:
        description: 'Creating token to test controller jobs'
        scope: "write"
        state: present
        validate_certs: false
        controller_host: "{{ controller_hostname }}"
        controller_username: "{{ controller_username }}"
        controller_password: "{{ controller_password }}"
      when: not controller_token

  roles:
    - {role: collection_repository_sync }
...
